# 機能一覧・MVPスコープ

## 1. 機能一覧

### 凡例

| 区分 | 説明 |
|------|------|
| **MVP** | 最初のリリースで必須 |
| **v1.1** | MVP後の次期リリース |
| **将来** | 将来の拡張候補 |

---

### 1.1 音声録音機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| R-01 | スピーカー出力録音 | WASAPI Loopback でシステム音声をキャプチャ | **MVP** |
| R-02 | マイク入力録音 | WASAPI SharedMode でマイク音声をキャプチャ | **MVP** |
| R-03 | デュアルトラック録音 | マイクとスピーカーを別WAVファイルに同時録音 | **MVP** |
| R-04 | 録音開始/停止 | ボタン操作で録音を制御 | **MVP** |
| R-05 | 一時停止/再開 | 録音の一時停止と再開 | **MVP** |
| R-06 | 録音経過時間表示 | リアルタイムで経過時間を表示 | **MVP** |
| R-07 | WAV定期フラッシュ | 5秒ごとにWAVをフラッシュしクラッシュ時のデータロスを最小化 | **MVP** |
| R-08 | WAVヘッダ修復 | クラッシュ時の不正WAVヘッダを修復 | **v1.1（実装済み）** |
| R-09 | 圧縮フォーマット変換 | WAV → FLAC/MP3 への変換 | **v1.1（実装済み）** |
| R-10 | 合成音声自動生成 | マイク+スピーカーを合成した軽量MP3（mixed.mp3）を録音後に自動生成 | **v1.8（実装済み）** |

### 1.2 録音可視化機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| V-01 | マイクレベルメーター | リアルタイムでマイク入力レベルを表示 (~30fps) | **MVP** |
| V-02 | スピーカーレベルメーター | リアルタイムでスピーカー出力レベルを表示 (~30fps) | **MVP** |
| V-03 | dB値表示 | RMSレベルをdBで数値表示 | **MVP** |
| V-04 | ヘルスステータス表示 | 正常/無音/クリッピング/データ停止を色分け表示 | **MVP** |
| V-05 | 無音警告 | 5秒以上の無音を検知して警告表示 | **MVP** |
| V-06 | クリッピング警告 | ピークが0.99以上でクリッピング警告 | **MVP** |
| V-07 | データ停止検知 | 500ms以上データ受信なしで警告表示 | **MVP** |

### 1.3 デバイス管理機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| D-01 | 入力デバイス一覧 | 利用可能なマイクデバイスをリスト表示 | **MVP** |
| D-02 | 出力デバイス一覧 | 利用可能なスピーカーデバイスをリスト表示 | **MVP** |
| D-03 | デバイス手動切替 | コンボボックスでデバイスを切り替え | **MVP** |
| D-04 | デバイスホットプラグ検知 | デバイスの接続/切断を自動検知してリスト更新 | **MVP** |
| D-05 | デフォルトデバイス自動選択 | 起動時にシステムデフォルトデバイスを自動選択 | **MVP** |

### 1.4 文字起こし機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| T-01 | ローカル文字起こし | Whisper.net によるオフライン文字起こし | **MVP** |
| T-02 | クラウド文字起こし | OpenAI Whisper API によるクラウド文字起こし | **MVP** |
| T-03 | STTエンジン切替 | ローカル/クラウドを設定で切り替え | **MVP** |
| T-04 | タイムスタンプ付き出力 | 各セグメントに開始/終了時刻を付与 | **MVP** |
| T-05 | 話者識別（基本） | マイク/スピーカーによる自分/相手の区別 | **MVP** |
| T-06 | 日本語最適化 | Whisper の言語設定をデフォルト `ja` に設定 | **MVP** |
| T-07 | 文字起こし進捗表示 | 処理中の進捗をプログレスバーで表示 | **MVP** |
| T-08 | 文字起こし再生成 | エンジンを選択して文字起こしを再実行 | **v1.2（実装済み）** |
| T-09 | 文字起こしコピー | 文字起こし結果をクリップボードにコピー | **v1.2（実装済み）** |
| T-10 | リアルタイム文字起こし | 録音中にストリーミングで文字起こし | 将来 |
| T-11 | 話者分離 | Speaker Diarization による参加者ごとの発言分離 | 将来 |

### 1.5 議事録生成機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| M-01 | テンプレート議事録 | 文字起こし結果をテンプレートに整形して出力 | **MVP** |
| M-02 | AI議事録生成（ローカル） | LLamaSharp + Qwen3 で要約・決定事項・アクションアイテム抽出 | **v1.1（実装済み）** |
| M-03 | AI議事録生成（クラウド） | OpenAI API で議事録を生成（モデル名指定可能） | **v1.2（実装済み）** |
| M-04 | 議事録再生成 | エンジンを選択して議事録を再生成 | **v1.2（実装済み）** |
| M-05 | 議事録コピー | 議事録をクリップボードにコピー | **v1.2（実装済み）** |
| M-06 | ととのえ機能 | 参加者・会議目的等のコンテキスト情報を追加して議事録をブラッシュアップ | **v1.3（実装済み）** |
| M-07 | ととのえ結果別ファイル保存 | ととのえ済み議事録を minutes_totonoe.md に別ファイルで保存 | **v1.3（実装済み）** |
| M-08 | プロンプト確認・編集 | 議事録・ととのえ生成時のシステムプロンプト/ユーザープロンプトを確認・編集可能。手動編集は再生成時に保持される。リセットボタンでプリセットのデフォルトに復元可能 | **v1.3（実装済み）** |
| M-13 | プロンプトプリセット管理 | AI議事録生成用のシステムプロンプトをプリセットとして複数保存・切替。設定画面でCRUD管理、メイン画面で選択。組み込みデフォルトプリセットは削除不可 | **v2.0（実装済み）** |
| M-10 | 議事録生成キャンセル | 議事録生成・ととのえ処理を途中でキャンセル可能（CancellationToken対応） | **v1.7（実装済み）** |
| M-11 | 経過時間表示 | 文字起こし・議事録生成・ととのえの処理中にリアルタイムで経過時間を表示、完了時に最終経過時間を表示 | **v1.7（実装済み）** |
| M-12 | トークン消費量表示 | AI利用時（OpenAI API / ローカルLLM）に消費トークン数を完了ステータスに表示 | **v1.7（実装済み）** |
| M-09 | リアルタイム要約 | 会議中にリアルタイムで要点整理 | 将来 |

### 1.6 データ管理機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| S-01 | ローカル保存 | セッションフォルダにWAV・テキスト・議事録を保存 | **MVP** |
| S-02 | セッション一覧 | 過去の録音セッションをリスト表示 | **v1.1（実装済み）** |
| S-03 | セッション保存先変更 | 設定画面でセッション保存先フォルダを変更 | **v1.2（実装済み）** |
| S-04 | セッション名編集 | セッション名をダブルクリックで編集可能 | **v1.3（実装済み）** |
| S-05 | セッション削除 | セッションを確認ダイアログ付きで削除 | **v1.3（実装済み）** |
| S-06 | 録音後自動処理 | 録音終了後に文字起こし→議事録生成を自動実行 | **v1.3（実装済み）** |
| S-07 | クラウドアップロード | Google Drive / OneDrive への自動アップロード | 将来 |

### 1.7 再生・確認機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| P-01 | 音声再生 | 録音データの再生（マイク/スピーカー個別） | **v1.1（実装済み）** |
| P-02 | 波形表示 | 音声の波形をビジュアルに表示 | **v1.1（実装済み）** |
| P-03 | シークスライダー | スライダーで再生位置を移動 | **v1.1（実装済み）** |
| P-04 | 文字起こし同期表示 | 再生位置に対応する文字起こしをハイライト | **v1.1（実装済み）** |
| P-05 | 話者位置の可視化 | 音声・文字起こし上で話者の位置を視認可能に | **v1.1（実装済み）** |

### 1.8 ネットワーク・システム機能

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| N-01 | ネットワーク状態表示 | オンライン/オフラインをアイコンで表示 | **MVP** |
| N-02 | オフラインモード保証 | ネットワーク不要で全基本機能が動作 | **MVP** |
| N-03 | アプリ設定 | デフォルトデバイス・STTエンジン・保存先等の設定 | **MVP** |

### 1.9 将来の拡張候補

| # | 機能 | 説明 | 区分 |
|---|------|------|------|
| F-01 | カレンダー連携 | Google Calendar / Outlook から会議情報を取得 | 将来 |
| F-02 | 参加者自動取得 | カレンダーから参加者一覧を取得して議事録に反映 | 将来 |
| F-03 | システムトレイ常駐 | タスクトレイに常駐し録音状態をアイコン表示、コンテキストメニューで録音操作、最小化時トレイ格納 | **v1.4（実装済み）** |
| F-04 | グローバルホットキー | 任意のキーで録音開始/停止 | 将来 |
| F-05 | 共有機能 | Chatwork / Slack / メール等での議事録共有 | 将来 |
| F-06 | ガジェット風コンパクト表示 | 録音中にコンパクトなガジェットウィンドウで常に最前面に表示、レベルメーター・経過時間・操作ボタンを表示、最小化でトレイ格納。縁取り＋全方向グローで暗い背景でも視認性を確保 | **v1.5（実装済み）** |
| F-07 | 会議アプリ自動検知 | Zoom / Teams / Google Meet / Webex のプロセスを5秒ポーリングで監視し、会議開始をバルーン通知。クリックで録音自動開始。会議終了時に停止通知。設定でON/OFF切替可能。Zoomはウィンドウタイトル検証で会議中のみ検知 | **v1.6（実装済み）** |
| F-08 | ファイルロギング | Serilog によるファイルログ出力（日次ローリング/31日保持）、グローバル例外ハンドラ（3種）で未処理例外をキャッチ | **v1.9（実装済み）** |

---

## 2. MVPスコープ

### 2.1 MVP の定義

**「オンラインミーティングの音声を確実に録音し、タイムスタンプ付きで文字起こしできる」** 状態を MVP とする。

### 2.2 MVP 対象機能

以下の機能 ID が MVP スコープ:

- **録音**: R-01 ~ R-07
- **可視化**: V-01 ~ V-07
- **デバイス**: D-01 ~ D-05
- **文字起こし**: T-01 ~ T-07
- **議事録**: M-01
- **データ**: S-01
- **ネットワーク**: N-01, N-02

### 2.3 MVP の品質基準

1. Teams / Zoom / Google Meet のミーティング音声を漏れなく録音できる
2. ヘッドセット使用時もスピーカー出力をキャプチャできる
3. 録音状態がレベルメーターとヘルスステータスで常に確認できる
4. 日本語の文字起こし精度が Google Pixel Recorder と同等以上
5. オフライン環境で録音・文字起こしが完結する
6. ミーティングアプリの動作に影響を与えない（CPU使用率 5% 以下を目安）

### 2.4 MVP の非対象（v1.1 以降）

- ~~AI による議事録要約~~ → v1.1 で実装済み
- ~~音声再生・波形表示・文字起こし同期~~ → v1.1 で実装済み
- ~~セッション一覧UI~~ → v1.1 で実装済み
- クラウドアップロード（将来）
- カレンダー連携（将来）

### 2.5 実装状況

- MVP 全機能（Phase 1-5）実装完了。
- v1.1 全機能実装完了:
  - R-08: WAVヘッダ修復（WavHeaderRepairService）
  - R-09: 圧縮フォーマット変換（MP3/FLAC）
  - M-02: AI議事録生成（LLamaSharp + Qwen3）
  - S-02: セッション一覧UI
  - P-01: 音声再生（NAudio WaveOutEvent）
  - P-02: 波形表示（WaveformControl）
  - P-03: シークスライダー
  - P-04: 文字起こし同期表示（発言バブル）
  - P-05: 話者位置の可視化（話者色分け・アイコン表示）
- v1.2 機能実装完了:
  - T-08: 文字起こし再生成（インラインエンジン選択）
  - T-09: 文字起こしクリップボードコピー
  - M-03: AI議事録生成・クラウド（OpenAI API、モデル名指定可能）
  - M-04: 議事録再生成（インラインエンジン選択）
  - M-05: 議事録クリップボードコピー
  - S-03: セッション保存先フォルダ変更
- v1.3 機能実装完了:
  - M-06: ととのえ機能（コンテキスト付き議事録ブラッシュアップ）
  - M-07: ととのえ結果別ファイル保存（minutes_totonoe.md）
  - M-08: プロンプト確認・編集（議事録/ととのえ両方）
  - S-04: セッション名編集（ダブルクリック）
  - S-05: セッション削除（確認ダイアログ付き）
  - S-06: 録音後自動処理（文字起こし→議事録生成の自動実行）
  - UI: 録音/ととのえモード切替トグルスイッチ
  - UI: バージョン表示（v0.1）＋ヘルプダイアログ
  - UI: Totonoeデザインシステム（グリーンアクセントカラー）
- v1.4 機能実装完了:
  - F-03: システムトレイ常駐（SystemTrayService）
    - System.Windows.Forms.NotifyIcon によるタスクトレイ常駐
    - 録音状態に応じたアイコンオーバーレイ（待機: アプリアイコン、録音中: 赤ドット、一時停止: オレンジドット）
    - コンテキストメニュー（ウィンドウ表示 / 録音開始・停止 / 一時停止・再開 / 終了）
    - ウィンドウ最小化・閉じるでトレイに格納、ダブルクリックで復元
    - 初回トレイ格納時にバルーン通知を表示
- v1.5 機能実装完了:
  - F-06: ガジェット風コンパクト録音表示（GadgetWindow）
    - ボーダーレス・角丸・Dark Card 背景のコンパクトウィンドウ（320×72px）
    - 常に最前面に表示（Topmost）、ドラッグ移動対応
    - 録音状態インジケーター・経過時間・ミニレベルメーター（MIC/OUT）
    - 一時停止/停止/メインに戻る操作ボタン
    - 最小化でトレイに格納、トレイからの復帰対応
    - 録音停止時に自動でメインウィンドウに復帰
    - トレイコンテキストメニューに「ガジェット表示」項目追加
- v1.6 機能実装完了:
  - F-07: 会議アプリ自動検知（ProcessMeetingDetectionService）
    - Zoom / Teams / Google Meet / Webex のプロセスを5秒間隔でポーリング監視
    - 会議アプリ検知時にバルーン通知、クリックでデフォルトデバイスで録音開始
    - 会議アプリ終了検知時に録音停止確認バルーン通知
    - 同一アプリの重複通知防止（プロセス消失まで再通知しない）
    - 録音中は新規検知をスキップ
    - 設定画面で機能のON/OFF切替可能
    - Google Meet はブラウザのウィンドウタイトルで検知
- v1.7 機能実装完了:
  - M-10: 議事録生成キャンセル（議事録・ととのえのCancellationToken対応、キャンセルボタンUI追加）
  - M-11: 経過時間表示（Stopwatch + DispatcherTimer 500ms更新、処理中リアルタイム表示、完了時に最終時間表示）
  - M-12: トークン消費量表示（OpenAI API: usage JSON抽出、ローカルLLM: 推論ループカウント）
  - MinutesResultモデル導入（IMinutesGenerator戻り値をテキスト+トークン情報の統合型に変更）
  - デフォルト音声デバイス自動選択の修正（Windows既定デバイスへのフォールバック改善）
  - Whisper.net CPU+CUDAランタイム併用（CUDA Toolkit未インストール時のCPUフォールバック対応）
  - CUDA Toolkitインストール手順をセットアップガイドに追加
- v1.8 機能実装完了:
  - R-10: 合成音声自動生成（mic.wav + speaker.wav → mixed.mp3、64kbps/16kHz/mono）
  - 録音後の自動処理フロー（文字起こし→議事録生成→合成音声生成）に統合
- v1.9 機能実装完了:
  - F-08: Serilog によるファイルロギング基盤（日次ローリング/31日保持）
  - グローバル例外ハンドラ 3 種（DispatcherUnhandled / AppDomain / UnobservedTask）
  - 主要サービス・ViewModel に ILogger<T> 注入（サイレント catch をログ出力に置換）
- v2.0 機能実装完了:
  - M-13: プロンプトプリセット管理（設定画面でCRUD、メイン画面で選択、組み込みデフォルト）
  - M-08 改善: 手動編集したプロンプトを議事録再生成時に保持、リセットボタン追加
  - F-07 改善: Zoom 会議検知にウィンドウタイトル検証を追加（アプリ起動のみでは誤検知しない）
  - F-06 改善: ガジェットウィンドウに縁取り（25%白）＋全方向グロー追加（暗い背景での視認性向上）
