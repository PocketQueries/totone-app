<Window x:Class="OnlineMeetingRecorder.Views.GadgetWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:OnlineMeetingRecorder.ViewModels"
        xmlns:conv="clr-namespace:OnlineMeetingRecorder.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Totonoe - Online Meeting Recorder"
        WindowStyle="None"
        AllowsTransparency="True"
        Topmost="True"
        ResizeMode="NoResize"
        SizeToContent="WidthAndHeight"
        Background="Transparent"
        ShowInTaskbar="True"
        FontFamily="{StaticResource PrimaryFont}"
        d:DataContext="{d:DesignInstance Type=vm:MainViewModel}"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <BooleanToVisibilityConverter x:Key="WpfBoolToVisibility"/>
    </Window.Resources>

    <!-- å¤–æž : Dark Card é¢¨ã®è§’ä¸¸ãƒœãƒ¼ãƒ€ãƒ¼ + å…¨æ–¹å‘ã‚°ãƒ­ãƒ¼ + ç¸å–ã‚Š -->
    <Border Background="#F01E1E1E"
            BorderBrush="#40FFFFFF"
            BorderThickness="1"
            CornerRadius="12"
            Padding="14,10"
            Width="380">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="0"
                              Color="#888888" Opacity="0.5"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- è¡Œ1: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ + çµŒéŽæ™‚é–“ + ãƒœã‚¿ãƒ³ç¾¤ -->
            <DockPanel Grid.Row="0" Margin="0,0,0,6">
                <!-- å³ç«¯: ãƒœã‚¿ãƒ³ç¾¤ -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right"
                            VerticalAlignment="Center">
                    <!-- éŒ²éŸ³é–‹å§‹ãƒœã‚¿ãƒ³ï¼ˆå¾…æ©Ÿä¸­ã®ã¿è¡¨ç¤ºï¼‰ -->
                    <Button Content="â—"
                            Click="StartButton_Click"
                            IsEnabled="{Binding Recording.CanStart}"
                            ToolTip="éŒ²éŸ³é–‹å§‹"
                            Foreground="{StaticResource AccentBrush}"
                            FontSize="14" Width="28" Height="28"
                            Padding="0" Margin="0,0,2,0">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource GhostButton}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Recording.IsRecording}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    <!-- ä¸€æ™‚åœæ­¢/å†é–‹ãƒœã‚¿ãƒ³ï¼ˆéŒ²éŸ³ä¸­ã®ã¿è¡¨ç¤ºï¼‰ -->
                    <Button Click="PauseButton_Click"
                            IsEnabled="{Binding Recording.CanPause}"
                            ToolTip="ä¸€æ™‚åœæ­¢ / å†é–‹"
                            Style="{StaticResource GhostButton}"
                            Foreground="#E8E8E8"
                            FontSize="14" Width="28" Height="28"
                            Padding="0" Margin="0,0,2,0">
                        <Button.Visibility>
                            <Binding Path="Recording.IsRecording">
                                <Binding.Converter>
                                    <BooleanToVisibilityConverter/>
                                </Binding.Converter>
                            </Binding>
                        </Button.Visibility>
                        <Button.Content>
                            <TextBlock>
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="â¸"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Recording.IsPaused}" Value="True">
                                                <Setter Property="Text" Value="â–¶"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Button.Content>
                    </Button>
                    <!-- åœæ­¢ãƒœã‚¿ãƒ³ï¼ˆéŒ²éŸ³ä¸­ã®ã¿è¡¨ç¤ºï¼‰ -->
                    <Button Content="â– "
                            Click="StopButton_Click"
                            IsEnabled="{Binding Recording.CanStop}"
                            ToolTip="åœæ­¢ã—ã¦ä¿å­˜"
                            Style="{StaticResource GhostButton}"
                            Foreground="{StaticResource AccentBrush}"
                            FontSize="14" Width="28" Height="28"
                            Padding="0" Margin="0,0,2,0">
                        <Button.Visibility>
                            <Binding Path="Recording.IsRecording">
                                <Binding.Converter>
                                    <BooleanToVisibilityConverter/>
                                </Binding.Converter>
                            </Binding>
                        </Button.Visibility>
                    </Button>
                    <!-- ãƒ‡ãƒã‚¤ã‚¹è¨­å®šãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
                    <Button Content="âš™"
                            Click="ToggleDevicePanel_Click"
                            ToolTip="ãƒ‡ãƒã‚¤ã‚¹è¨­å®š"
                            Style="{StaticResource GhostButton}"
                            Foreground="#A0A0A0"
                            FontSize="13" Width="28" Height="28"
                            Padding="0" Margin="0,0,2,0"/>
                    <!-- ã¨ã¨ã®ãˆç”»é¢ã‚’é–‹ããƒœã‚¿ãƒ³ -->
                    <Button Content="ðŸ“‹"
                            Click="ExpandButton_Click"
                            ToolTip="ã¨ã¨ã®ãˆï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰"
                            Style="{StaticResource GhostButton}"
                            Foreground="#A0A0A0"
                            FontSize="13" Width="28" Height="28"
                            Padding="0" Margin="0,0,2,0"/>
                    <!-- æœ€å°åŒ–ï¼ˆãƒˆãƒ¬ã‚¤ã«æ ¼ç´ï¼‰ãƒœã‚¿ãƒ³ -->
                    <Button Content="â”€"
                            Click="MinimizeButton_Click"
                            ToolTip="æœ€å°åŒ–ï¼ˆãƒˆãƒ¬ã‚¤ã«æ ¼ç´ï¼‰"
                            Style="{StaticResource GhostButton}"
                            Foreground="#A0A0A0"
                            FontSize="13" Width="28" Height="28"
                            Padding="0"/>
                </StackPanel>

                <!-- å·¦: ã‚¿ã‚¤ãƒˆãƒ« + éŒ²éŸ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ + æ™‚é–“ -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- ã‚¢ãƒ—ãƒªå -->
                    <TextBlock Text="Totonoe"
                               FontSize="12" FontWeight="SemiBold"
                               Foreground="#A0A0A0"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>
                    <!-- éŒ²éŸ³çŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
                    <Ellipse Width="8" Height="8" Margin="0,0,6,0"
                             VerticalAlignment="Center">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="{StaticResource AccentBrush}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Recording.IsPaused}" Value="True">
                                        <Setter Property="Fill" Value="#E67E22"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚­ã‚¹ãƒˆ -->
                    <TextBlock Text="{Binding Recording.StatusText}"
                               FontSize="11"
                               Foreground="#A0A0A0"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <!-- çµŒéŽæ™‚é–“ -->
                    <TextBlock Text="{Binding Recording.ElapsedTimeText}"
                               FontFamily="{StaticResource MonoFont}"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="#E8E8E8"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </DockPanel>

            <!-- è¡Œ2: ãƒŸãƒ‹ãƒ¬ãƒ™ãƒ«ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆMIC + OUTï¼‰ -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- MIC ãƒ©ãƒ™ãƒ« -->
                <TextBlock Grid.Column="0" Text="ðŸŽ™"
                           FontSize="10" VerticalAlignment="Center"
                           Margin="0,0,4,0"/>
                <!-- MIC ãƒ¬ãƒ™ãƒ«ãƒãƒ¼ -->
                <Border Grid.Column="1" Background="#333333"
                        CornerRadius="3" Height="6" VerticalAlignment="Center"
                        ClipToBounds="True">
                    <Border Background="{StaticResource AccentBrush}"
                            CornerRadius="3"
                            RenderTransformOrigin="0,0.5">
                        <Border.RenderTransform>
                            <ScaleTransform ScaleX="{Binding AudioLevel.MicRmsLevel}"/>
                        </Border.RenderTransform>
                    </Border>
                </Border>

                <!-- OUT ãƒ©ãƒ™ãƒ« -->
                <TextBlock Grid.Column="3" Text="ðŸ”Š"
                           FontSize="10" VerticalAlignment="Center"
                           Margin="0,0,4,0"/>
                <!-- OUT ãƒ¬ãƒ™ãƒ«ãƒãƒ¼ -->
                <Border Grid.Column="4" Background="#333333"
                        CornerRadius="3" Height="6" VerticalAlignment="Center"
                        ClipToBounds="True">
                    <Border Background="{StaticResource AccentBrush}"
                            CornerRadius="3"
                            RenderTransformOrigin="0,0.5">
                        <Border.RenderTransform>
                            <ScaleTransform ScaleX="{Binding AudioLevel.SpeakerRmsLevel}"/>
                        </Border.RenderTransform>
                    </Border>
                </Border>
            </Grid>

            <!-- è¡Œ3: ãƒ‡ãƒã‚¤ã‚¹é¸æŠžãƒ‘ãƒãƒ«ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰ -->
            <Border x:Name="DevicePanel" Grid.Row="2"
                    Background="#15FFFFFF" CornerRadius="8"
                    Padding="8,6" Margin="0,6,0,0"
                    Visibility="Collapsed">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- ãƒžã‚¤ã‚¯é¸æŠž -->
                    <TextBlock Grid.Row="0" Grid.Column="0"
                               Text="ðŸŽ™" FontSize="11"
                               Foreground="#A0A0A0"
                               VerticalAlignment="Center"
                               Margin="0,0,6,4"/>
                    <ComboBox Grid.Row="0" Grid.Column="1"
                              Style="{StaticResource DarkComboBox}"
                              ItemContainerStyle="{StaticResource DarkComboBoxItem}"
                              ItemsSource="{Binding DeviceSelection.InputDevices}"
                              SelectedItem="{Binding DeviceSelection.SelectedInputDevice}"
                              DisplayMemberPath="FriendlyName"
                              IsEnabled="{Binding Recording.CanStart}"
                              FontSize="11" Height="26"
                              Margin="0,0,0,4"/>

                    <!-- ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼é¸æŠž -->
                    <TextBlock Grid.Row="1" Grid.Column="0"
                               Text="ðŸ”Š" FontSize="11"
                               Foreground="#A0A0A0"
                               VerticalAlignment="Center"
                               Margin="0,0,6,0"/>
                    <ComboBox Grid.Row="1" Grid.Column="1"
                              Style="{StaticResource DarkComboBox}"
                              ItemContainerStyle="{StaticResource DarkComboBoxItem}"
                              ItemsSource="{Binding DeviceSelection.OutputDevices}"
                              SelectedItem="{Binding DeviceSelection.SelectedOutputDevice}"
                              DisplayMemberPath="FriendlyName"
                              IsEnabled="{Binding Recording.CanStart}"
                              FontSize="11" Height="26"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
